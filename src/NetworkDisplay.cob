IDENTIFICATION DIVISION.
       PROGRAM-ID. NETWORKDISPLAY.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT CONNECTIONS-FILE ASSIGN TO "data/connections.dat"
               ORGANIZATION IS LINE SEQUENTIAL
               FILE STATUS IS WS-CONN-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD  CONNECTIONS-FILE.
       01  CONN-RECORD         PIC X(60).

       WORKING-STORAGE SECTION.
       01  WS-CONN-STATUS      PIC XX.
       01  WS-OUTPUT-LINE      PIC X(80).
       01  WS-COMMAND          PIC X(20).
       01  WS-LINE             PIC X(80).
       01  WS-CURRENT-USER     PIC X(20).
       01  WS-CONNECTED-USER   PIC X(20).
       01  WS-CONNECTION-COUNT PIC 99 VALUE 0.
       01  WS-EOF              PIC X VALUE 'N'.
       01  WS-TRIMMED-CURRENT  PIC X(20).
       01  WS-USER1            PIC X(15).
       01  WS-USER2            PIC X(15).
       01  WS-TRIMMED-USER1    PIC X(15).
       01  WS-TRIMMED-USER2    PIC X(15).
       01  WS-UNIVERSITY       PIC X(15).
       01  WS-MAJOR            PIC X(15).

       LINKAGE SECTION.
       01  LS-USERNAME         PIC X(20).

       PROCEDURE DIVISION USING LS-USERNAME.
       MAIN-PROCEDURE.
           MOVE "--- Your Network ---" TO WS-OUTPUT-LINE
           PERFORM WRITE-BOTH

           PERFORM DISPLAY-NETWORK

           MOVE "--------------------" TO WS-OUTPUT-LINE
           PERFORM WRITE-BOTH
           GOBACK.

       DISPLAY-NETWORK.
           MOVE FUNCTION TRIM(LS-USERNAME) TO WS-TRIMMED-CURRENT
           MOVE 0 TO WS-CONNECTION-COUNT

           OPEN INPUT CONNECTIONS-FILE

           IF WS-CONN-STATUS NOT = "00"
               MOVE "Error opening connections file." TO WS-OUTPUT-LINE
               PERFORM WRITE-BOTH
           ELSE
               READ CONNECTIONS-FILE
                   AT END MOVE 'Y' TO WS-EOF
               END-READ
               PERFORM UNTIL WS-EOF = 'Y'
                   PERFORM CHECK-CONNECTION
                   READ CONNECTIONS-FILE
                       AT END MOVE 'Y' TO WS-EOF
                   END-READ
               END-PERFORM
               CLOSE CONNECTIONS-FILE
           END-IF

           IF WS-CONNECTION-COUNT = 0
               MOVE "You have no connections at this time." TO WS-OUTPUT-LINE
               PERFORM WRITE-BOTH
           END-IF.

       CHECK-CONNECTION.
           MOVE CONN-RECORD(1:15)   TO WS-USER1
           MOVE CONN-RECORD(16:15)  TO WS-USER2
           MOVE CONN-RECORD(31:15)  TO WS-UNIVERSITY
           MOVE CONN-RECORD(46:15)  TO WS-MAJOR

           MOVE FUNCTION TRIM(WS-USER1) TO WS-TRIMMED-USER1
           MOVE FUNCTION TRIM(WS-USER2) TO WS-TRIMMED-USER2

           MOVE SPACES TO WS-CONNECTED-USER

           IF WS-TRIMMED-USER1 = WS-TRIMMED-CURRENT
               MOVE WS-TRIMMED-USER2 TO WS-CONNECTED-USER
               PERFORM DISPLAY-CONNECTION-INFO
           ELSE IF WS-TRIMMED-USER2 = WS-TRIMMED-CURRENT
               MOVE WS-TRIMMED-USER1 TO WS-CONNECTED-USER
               PERFORM DISPLAY-CONNECTION-INFO
           END-IF.

       DISPLAY-CONNECTION-INFO.
           ADD 1 TO WS-CONNECTION-COUNT

           STRING "Connected with: " DELIMITED BY SIZE
                  FUNCTION TRIM(WS-CONNECTED-USER) DELIMITED BY SIZE
                  INTO WS-OUTPUT-LINE
           END-STRING

           PERFORM WRITE-BOTH
           MOVE " " TO WS-OUTPUT-LINE
           PERFORM WRITE-BOTH.

       WRITE-BOTH.
           MOVE WS-OUTPUT-LINE TO WS-LINE
           MOVE "WRITE" TO WS-COMMAND
           CALL "IO-MODULE" USING WS-COMMAND WS-LINE
           MOVE SPACES TO WS-OUTPUT-LINE.
      
      END PROGRAM NETWORKDISPLAY.
